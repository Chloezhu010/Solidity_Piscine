# Project P04 – DEX 101 (Uniswap v1-style AMM)

**Level:** Intermediate–Advanced  
**Estimated Time:** 5–6 days  

---

## Objective
Build a constant-product Automated Market Maker (AMM) similar to Uniswap v1.  
This introduces liquidity pools, LP tokens, and swap pricing with the **x * y = k** invariant.

---

## Learning Goals
- Understand AMM mechanics and swap pricing math.
- Implement liquidity provision with LP tokens.
- Manage ETH–ERC20 pools and enforce constant-product invariants.
- Handle slippage and frontrunning risks.

---

## Requirements
1. **Liquidity Management**
   - `addLiquidity(uint256 tokenAmount)`:
     - User deposits ETH + tokens at the correct ratio.
     - Mint LP tokens representing their pool share.
   - `removeLiquidity(uint256 lpAmount)`:
     - Burn LP tokens and return proportional ETH + tokens.

2. **Swaps**
   - `swapExactETHForTokens(uint256 minTokensOut)`
   - `swapExactTokensForETH(uint256 tokenAmount, uint256 minETHOut)`
   - Use constant-product formula to calculate swap outputs.

3. **Tracking**
   - Store `reserveETH` and `reserveToken`.
   - Emit events for swaps and liquidity changes.

4. **Constraints**
   - Use OpenZeppelin ERC20 for LP tokens.
   - Implement **slippage protection** using minOut checks.

---

## Deliverables
- `SimpleAMM.sol`
- Foundry tests for add/remove liquidity and swaps.
- Deployment script for initial liquidity.
- `README.md` explaining your math and design decisions.

---

## Bonus Challenges
### Gas Optimization
- Cache reserves locally in functions instead of multiple storage reads.
- Minimize SSTORE operations when updating state.

### Security
- Add **reentrancy guards**.
- Prevent flash-loan manipulation of reserves (consider TWAP oracles).

### Research
- Read Uniswap v2’s `swap()` and `mint()` implementations:
  - Draw a diagram of the swap process.
  - Explain why fee-on-transfer tokens can break AMMs.

---

## Peer Review Defense
Be ready to explain:
- Your AMM math derivation.
- How slippage is handled.
- Attack vectors (flash loans, sandwiching) and mitigations.

---

## Resources
- [Uniswap v1 Whitepaper](https://hackmd.io/@HaydenAdams/HJ9jLsfTz)
- [Solidity by Example – AMM](https://solidity-by-example.org/defi/constant-product-amm/)
- [TWAP Oracles](https://docs.uniswap.org/contracts/v2/concepts/core-concepts/oracles)
